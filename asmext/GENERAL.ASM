	OPTION	OFFSET:GROUP
	PUBLIC	I2L,E121,E122,E141,E142,E143,E144,E241,E243,SWAPBYT,CHKSUM,CHKSUMW
	PUBLIC	CHKSUM2,CRC16,CRYPT,FINDIF,BINSTR,HALT,REBOOT
	PUBLIC	_CRC16T
	EXTRN	_FINSTR:FAR,_PUTSTR:FAR
	EXTRN	STR_BUF:BYTE
DGROUP	GROUP	ASMEXT_DATA
ASMEXT_TEXT	SEGMENT	PARA	PUBLIC	'CODE'
	ASSUME	CS:ASMEXT_TEXT,DS:DGROUP,ES:NOTHING,SS:DGROUP
I2L	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	XOR	DX,DX
	POP	BP
	RET	2
I2L	ENDP
E121	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	XOR	AH,AH
	POP	BP
	RET	2
E121	ENDP
E122	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	MOV	AL,AH
	XOR	AH,AH
	POP	BP
	RET	2
E122	ENDP
E141	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	XOR	AH,AH
	POP	BP
	RET	4
E141	ENDP
E142	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	MOV	AL,AH
	XOR	AH,AH
	POP	BP
	RET	4
E142	ENDP
E143	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+8]
	XOR	AH,AH
	POP	BP
	RET	4
E143	ENDP
E144	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+8]
	MOV	AL,AH
	XOR	AH,AH
	POP	BP
	RET	4
E144	ENDP
E241	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	POP	BP
	RET	4
E241	ENDP
E243	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+8]
	POP	BP
	RET	4
E243	ENDP
SWAPBYT	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+6]
	XCHG	AL,AH
	POP	BP
	RET	2
SWAPBYT	ENDP
CHKSUM	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	PUSH	[BP+8]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	BX,AX
	MOV	CX,[BP+6]
	XOR	AX,AX
@@:	ADD	AX,ES:[BX]
	INC	BX
	LOOP	@B
	NEG	AX
	POP	BP
	RET	4
CHKSUM	ENDP
CHKSUMW	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	PUSH	[BP+8]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	BX,AX
	MOV	CX,[BP+6]
	SHR	CX,1
	XOR	AX,AX
@@:	ADD	AX,ES:[BX]
	ADD	BX,2
	LOOP	@B
	NEG	AX
	POP	BP
	RET	4
CHKSUMW	ENDP
CHKSUM2	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	PUSH	[BP+8]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	BX,AX
	MOV	CX,[BP+6]
	SHR	CX,1
	XOR	AX,AX
@@:	ADD	AX,ES:[BX]
	ADC	AX,0
	ADD	BX,2
	LOOP	@B
	POP	BP
	RET	4
CHKSUM2	ENDP
CRC16	PROC	FAR
	PUSH	BP
	PUSH	SI
	PUSH	DI
	MOV	BP,SP
	PUSH	[BP+0EH]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	SI,AX
	MOV	CX,[BP+0CH]
	MOV	DX,[BP+0AH]
	LEA	DI,[_CRC16T]
	MOV	AX,0E295H
	TEST	DX,DX
	JZ	@F
	MOV	AX,0D2F6H
@@:	MOV	BL,ES:[SI]
	XOR	BL,AH
	XOR	BH,BH
	SHL	BX,1
	MOV	AH,AL
	XOR	AL,AL
	XOR	AX,[BX+DI]
	INC	SI
	LOOP	@B
	XOR	DX,DX
	POP	DI
	POP	SI
	POP	BP
	RET	6
CRC16	ENDP
CRYPT	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	PUSH	[BP+0CH]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	BX,AX
	MOV	CX,[BP+0AH]
	SHR	CX,1
	MOV	DX,[BP+8]
	MOV	AX,[BP+6]
@@:	XOR	ES:[BX],AX
	ADD	BX,2
	XOR	AH,DL
	SUB	AX,DX
	ROL	AX,1
	XOR	DX,AX
	LOOP	@B
	POP	BP
	RET	8
CRYPT	ENDP
FINDIF	PROC	FAR
	PUSH	BP
	PUSH	DI
	MOV	BP,SP
	PUSH	[BP+0AH]
	CALL	_FINSTR
	ADD	SP,2
	MOV	ES,DX
	MOV	BX,AX
	MOV	DI,AX
	MOV	CX,[BP+8]
	MOV	AL,ES:[DI]
	REPE	SCASB
	JE	@F
	DEC	DI
@@:	SUB	DI,BX
	MOV	AX,DI
	XOR	DX,DX
	POP	DI
	POP	BP
	RET	4
FINDIF	ENDP
BINSTR	PROC	FAR
	PUSH	BP
	PUSH	DI
	MOV	BP,SP
	MOV	DX,[BP+0AH]
	MOV	AX,[BP+8]
	MOV	CX,10H
	TEST	AX,AX
	JNZ	@F
	MOV	CX,8
	MOV	DH,DL
@@:	MOV	AX,DS
	MOV	ES,AX
	LEA	DI,[STR_BUF]
	PUSH	CX
@@:	MOV	AL,30H
	SHL	DX,1
	ADC	AL,0
	STOSB
	LOOP	@B
	CALL	_PUTSTR
	ADD	SP,2
	POP	DI
	POP	BP
	RET	4
BINSTR	ENDP
HALT	PROC	FAR
	CLI
	HLT
HALT	ENDP
REBOOT	PROC	FAR
	MOV	AX,40H
	MOV	DS,AX
	MOV	WORD PTR DS:[72H],1234H
	DB	0EAH,0,0,0FFH,0FFH
REBOOT	ENDP
ASMEXT_TEXT	ENDS
ASMEXT_DATA	SEGMENT	WORD	PUBLIC	'DATA'
_CRC16T	DB	000H,000H,021H,010H,042H,020H,063H,030H
	DB	084H,040H,0A5H,050H,0C6H,060H,0E7H,070H
	DB	008H,081H,029H,091H,04AH,0A1H,06BH,0B1H
	DB	08CH,0C1H,0ADH,0D1H,0CEH,0E1H,0EFH,0F1H
	DB	031H,012H,010H,002H,073H,032H,052H,022H
	DB	0B5H,052H,094H,042H,0F7H,072H,0D6H,062H
	DB	039H,093H,018H,083H,07BH,0B3H,05AH,0A3H
	DB	0BDH,0D3H,09CH,0C3H,0FFH,0F3H,0DEH,0E3H
	DB	062H,024H,043H,034H,020H,004H,001H,014H
	DB	0E6H,064H,0C7H,074H,0A4H,044H,085H,054H
	DB	06AH,0A5H,04BH,0B5H,028H,085H,009H,095H
	DB	0EEH,0E5H,0CFH,0F5H,0ACH,0C5H,08DH,0D5H
	DB	053H,036H,072H,026H,011H,016H,030H,006H
	DB	0D7H,076H,0F6H,066H,095H,056H,0B4H,046H
	DB	05BH,0B7H,07AH,0A7H,019H,097H,038H,087H
	DB	0DFH,0F7H,0FEH,0E7H,09DH,0D7H,0BCH,0C7H
	DB	0C4H,048H,0E5H,058H,086H,068H,0A7H,078H
	DB	040H,008H,061H,018H,002H,028H,023H,038H
	DB	0CCH,0C9H,0EDH,0D9H,08EH,0E9H,0AFH,0F9H
	DB	048H,089H,069H,099H,00AH,0A9H,02BH,0B9H
	DB	0F5H,05AH,0D4H,04AH,0B7H,07AH,096H,06AH
	DB	071H,01AH,050H,00AH,033H,03AH,012H,02AH
	DB	0FDH,0DBH,0DCH,0CBH,0BFH,0FBH,09EH,0EBH
	DB	079H,09BH,058H,08BH,03BH,0BBH,01AH,0ABH
	DB	0A6H,06CH,087H,07CH,0E4H,04CH,0C5H,05CH
	DB	022H,02CH,003H,03CH,060H,00CH,041H,01CH
	DB	0AEH,0EDH,08FH,0FDH,0ECH,0CDH,0CDH,0DDH
	DB	02AH,0ADH,00BH,0BDH,068H,08DH,049H,09DH
	DB	097H,07EH,0B6H,06EH,0D5H,05EH,0F4H,04EH
	DB	013H,03EH,032H,02EH,051H,01EH,070H,00EH
	DB	09FH,0FFH,0BEH,0EFH,0DDH,0DFH,0FCH,0CFH
	DB	01BH,0BFH,03AH,0AFH,059H,09FH,078H,08FH
	DB	088H,091H,0A9H,081H,0CAH,0B1H,0EBH,0A1H
	DB	00CH,0D1H,02DH,0C1H,04EH,0F1H,06FH,0E1H
	DB	080H,010H,0A1H,000H,0C2H,030H,0E3H,020H
	DB	004H,050H,025H,040H,046H,070H,067H,060H
	DB	0B9H,083H,098H,093H,0FBH,0A3H,0DAH,0B3H
	DB	03DH,0C3H,01CH,0D3H,07FH,0E3H,05EH,0F3H
	DB	0B1H,002H,090H,012H,0F3H,022H,0D2H,032H
	DB	035H,042H,014H,052H,077H,062H,056H,072H
	DB	0EAH,0B5H,0CBH,0A5H,0A8H,095H,089H,085H
	DB	06EH,0F5H,04FH,0E5H,02CH,0D5H,00DH,0C5H
	DB	0E2H,034H,0C3H,024H,0A0H,014H,081H,004H
	DB	066H,074H,047H,064H,024H,054H,005H,044H
	DB	0DBH,0A7H,0FAH,0B7H,099H,087H,0B8H,097H
	DB	05FH,0E7H,07EH,0F7H,01DH,0C7H,03CH,0D7H
	DB	0D3H,026H,0F2H,036H,091H,006H,0B0H,016H
	DB	057H,066H,076H,076H,015H,046H,034H,056H
	DB	04CH,0D9H,06DH,0C9H,00EH,0F9H,02FH,0E9H
	DB	0C8H,099H,0E9H,089H,08AH,0B9H,0ABH,0A9H
	DB	044H,058H,065H,048H,006H,078H,027H,068H
	DB	0C0H,018H,0E1H,008H,082H,038H,0A3H,028H
	DB	07DH,0CBH,05CH,0DBH,03FH,0EBH,01EH,0FBH
	DB	0F9H,08BH,0D8H,09BH,0BBH,0ABH,09AH,0BBH
	DB	075H,04AH,054H,05AH,037H,06AH,016H,07AH
	DB	0F1H,00AH,0D0H,01AH,0B3H,02AH,092H,03AH
	DB	02EH,0FDH,00FH,0EDH,06CH,0DDH,04DH,0CDH
	DB	0AAH,0BDH,08BH,0ADH,0E8H,09DH,0C9H,08DH
	DB	026H,07CH,007H,06CH,064H,05CH,045H,04CH
	DB	0A2H,03CH,083H,02CH,0E0H,01CH,0C1H,00CH
	DB	01FH,0EFH,03EH,0FFH,05DH,0CFH,07CH,0DFH
	DB	09BH,0AFH,0BAH,0BFH,0D9H,08FH,0F8H,09FH
	DB	017H,06EH,036H,07EH,055H,04EH,074H,05EH
	DB	093H,02EH,0B2H,03EH,0D1H,00EH,0F0H,01EH
ASMEXT_DATA	ENDS
	END
