	OPTION	OFFSET:GROUP
	PUBLIC	MEMSIZE,BIOSVER,CPUTYPE,HARDTBL
DGROUP	GROUP	ASMEXT_DATA
ASMEXT_TEXT	SEGMENT	PARA	PUBLIC	'CODE'
	ASSUME	CS:ASMEXT_TEXT,DS:DGROUP,ES:NOTHING,SS:DGROUP
MEMSIZE	PROC	FAR
	MOV	AL,0EH
	CALL	RD_CMOS
	TEST	AL,11111000B
	JNZ	@F
	MOV	AL,14H
	CALL	RD_CMOS
	AND	AX,2
	ROR	AX,1
	ROR	AX,1
	MOV	DX,AX
	MOV	AL,16H
	CALL	RD_CMOS
	CMP	AL,4
	JA	@F
	OR	DH,AL
	MOV	AL,15H
	CALL	RD_CMOS
	OR	DL,AL
	MOV	AL,18H
	CALL	RD_CMOS
	MOV	AH,AL
	MOV	AL,17H
	CALL	RD_CMOS
	RET
@@:	MOV	AX,0FFFFH
	MOV	DX,AX
	RET
MEMSIZE	ENDP
RD_CMOS	PROC	NEAR
	PUSHF
	CLI
	ROL	AL,1
	STC
	RCR	AL,1
	OUT	70H,AL
	JMP	SHORT	$+2
	JMP	SHORT	$+2
	IN	AL,71H
	PUSH	AX
	MOV	AL,1AH
	RCR	AL,1
	OUT	70H,AL
	JMP	SHORT	$+2
	JMP	SHORT	$+2
	IN	AL,71H
	POP	AX
	PUSH	CS
	CALL	NULLINT
	RET
RD_CMOS	ENDP
NULLINT	PROC	NEAR
	IRET
NULLINT	ENDP
BIOSVER	PROC	FAR
	PUSH	SI
	MOV	AX,0F000H
	MOV	ES,AX
	MOV	SI,0FFF5H
	MOV	CX,8
L1:	DB	26H,0ACH
	CMP	CX,6
	JE	L2
	CMP	CX,3
	JE	L2
	SUB	AL,30H
	JC	L4
	CMP	AL,9
	JA	L4
	CMP	CX,7
	JE	@F
	CMP	CX,4
	JE	@F
	CMP	CX,1
	JE	@F
	MOV	AH,AL
@@:	CMP	CX,7
	JNE	@F
	AAD
	MOV	DL,AL
@@:	CMP	CX,4
	JNE	@F
	AAD
	MOV	BH,AL
@@:	CMP	CX,1
	JNE	L3
	AAD
	MOV	DH,AL
	JMP	L3
L2:	CMP	AL,2FH
	JNE	L4
L3:	LOOP	L1
	JMP	L5
L4:	MOV	DX,0FFFFH
	MOV	BH,DH
L5:	MOV	AL,ES:[0FFFEH]
	MOV	AH,BH
	POP	SI
	RET
BIOSVER	ENDP
CPUTYPE	PROC	FAR
	SUB	BX,BX
	PUSH	SP
	POP	AX
	CMP	AX,SP
	JNE	CTRET
	.286P
	INC	BH
	SMSW	AX
	TEST	AX,1
	JZ	@F
	INC	BH
	MOV	BL,1
@@:	PUSH	WORD PTR 7000H
	POPF
	PUSHF
	POP	AX
	AND	AX,7000H
	JZ	@F
	MOV	BL,1
@@:	TEST	BL,BL
	JZ	CTRET
	.386P
	PUSH	EBX
	PUSH	ECX
	PUSH	EBP
	MOV	EBP,ESP
	AND	ESP,0FFFFFFFCH
	PUSHFD
	POP	EAX
	MOV	ECX,EAX
	AND	ECX,40000H
	XOR	EAX,40000H
	PUSH	EAX
	POPFD
	PUSHFD
	POP	EAX
	MOV	EBX,EAX
	AND	EBX,40000H
	XOR	EAX,40000H
	PUSH	EAX
	POPFD
	MOV	ESP,EBP
	CMP	EBX,ECX
	POP	EBP
	POP	ECX
	POP	EBX
	JZ	CTRET
	INC	BL
	.8086
CTRET:	MOV	AX,BX
	XOR	DX,DX
	RET
CPUTYPE	ENDP
HARDTBL	PROC	FAR
	PUSH	SI
	MOV	CX,2
C1:	MOV	SI,CX
	SHL	SI,1
	SHL	SI,1
	MOV	AX,SI
	SHL	SI,1
	SHL	SI,1
	ADD	SI,AX
	ADD	SI,0F0H
	XOR	AX,AX
	MOV	ES,AX
	LES	SI,ES:[SI]
	PUSH	CX
	XOR	BX,BX
	MOV	CX,8
@@:	DB	26H,0ADH
	ADD	BX,AX
	ADC	BX,0
	LOOP	@B
	POP	CX
	CMP	CX,2
	JNE	@F
	MOV	DX,BX
@@:	LOOP	C1
	MOV	AX,BX
	POP	SI
	RET
HARDTBL	ENDP
ASMEXT_TEXT	ENDS
ASMEXT_DATA	SEGMENT	WORD	PUBLIC	'DATA'
ASMEXT_DATA	ENDS
	END
