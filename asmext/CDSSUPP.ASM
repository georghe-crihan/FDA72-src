	OPTION	OFFSET:GROUP
	PUBLIC	CDSCHCK,CDSINIT
DGROUP	GROUP	ASMEXT_DATA
ASMEXT_TEXT	SEGMENT	PARA	PUBLIC	'CODE'
	ASSUME	CS:ASMEXT_TEXT,DS:DGROUP,ES:NOTHING,SS:DGROUP
CDSINIT	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,3000H
	INT	21H
	XCHG	AL,AH
	MOV	WORD PTR [OSMINOR],AX
	CMP	AX,30AH
	JB	@F
	MOV	AH,52H
	INT	21H
	MOV	AX,ES:[BX+20H]
	MOV	[CDSLEN],AH
	XOR	AH,AH
	MOV	[BP+6],AX
	MOV	AX,ES:[BX+16H]
	MOV	WORD PTR [CDSADR],AX
	MOV	AX,ES:[BX+18H]
	MOV	WORD PTR [CDSADR+2],AX
	XOR	AX,AX
@@:	POP	BP
	RET	2
CDSINIT	ENDP
CDSCHCK	PROC	FAR
	PUSH	BP
	MOV	BP,SP
	MOV	AX,[BP+0AH]
	CMP	AL,[CDSLEN]
	JAE	CDSERR
	MOV	AH,51H
	CMP	[OSMAJOR],4
	JB	@F
	MOV	AH,58H
@@:	MUL	AH
	LES	BX,[CDSADR]
	ADD	BX,AX
	MOV	AX,ES:[BX+43H]
	AND	AX,0D000H
	CMP	AX,4000H
	JNE	CDSERR
	MOV	AL,ES:[BX]
	SUB	AL,41H
	JC	CDSERR
	CMP	AL,1AH
	JAE	CDSERR
	LES	BX,ES:[BX+45H]
	CMP	AL,ES:[BX]
	JNE	CDSERR


CDSCHCK	ENDP
ASMEXT_TEXT	ENDS
ASMEXT_DATA	SEGMENT	WORD	PUBLIC	'DATA'
OSMINOR	DB	?
OSMAJOR	DB	?
CDSLEN	DB	?
CDSADR	DD	?
ASMEXT_DATA	ENDS
	END
